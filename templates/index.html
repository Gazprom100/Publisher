    <!-- Scripts -->
    <script src="https://cdn.plot.ly/plotly-2.30.1.min.js"></script>
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Инициализация всех компонентов после загрузки DOM
        const refreshButton = document.getElementById('refreshData');
        if (refreshButton) {
            refreshButton.addEventListener('click', function() {
                updateAnalytics();
                updateChannelHealth();
                updateSchedule();
            });
        }

        // Инициализация Socket.IO
        const socket = io();

        // Обновление данных каждые 5 минут
        setInterval(() => {
            updateAnalytics();
            updateChannelHealth();
            updateSchedule();
        }, 300000);

        // Первоначальное обновление данных
        updateAnalytics();
        updateChannelHealth();
        updateSchedule();
    });

    // Функция обновления аналитики
    function updateAnalytics() {
        fetch('/api/analytics')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Обновление статистики
                    const elements = {
                        'total-posts': data.total_posts,
                        'posts-today': data.posts_today,
                        'active-channels': data.active_channels,
                        'total-reach': data.total_reach
                    };

                    // Безопасное обновление элементов
                    Object.entries(elements).forEach(([id, value]) => {
                        const element = document.getElementById(id);
                        if (element) {
                            element.textContent = value;
                        }
                    });

                    // Обновление графиков только если элементы существуют
                    const activityChart = document.getElementById('activity-chart');
                    if (activityChart) {
                        const activityTrace = {
                            x: Object.keys(data.activity_by_hour),
                            y: Object.values(data.activity_by_hour),
                            type: 'bar',
                            marker: {
                                color: '#2196F3'
                            }
                        };

                        const activityLayout = {
                            title: 'Активность по часам',
                            paper_bgcolor: 'rgba(0,0,0,0)',
                            plot_bgcolor: 'rgba(0,0,0,0)',
                            font: {
                                color: document.body.classList.contains('dark-theme') ? '#ffffff' : '#000000'
                            },
                            margin: { t: 30, r: 30, b: 40, l: 40 }
                        };

                        Plotly.newPlot('activity-chart', [activityTrace], activityLayout);
                    }

                    const contentTypeChart = document.getElementById('content-type-chart');
                    if (contentTypeChart) {
                        const contentTypeTrace = {
                            values: [data.posts_with_photo, data.posts_without_photo],
                            labels: ['С фото', 'Без фото'],
                            type: 'pie',
                            marker: {
                                colors: ['#2196F3', '#FFC107']
                            }
                        };

                        const contentTypeLayout = {
                            title: 'Типы контента',
                            paper_bgcolor: 'rgba(0,0,0,0)',
                            plot_bgcolor: 'rgba(0,0,0,0)',
                            font: {
                                color: document.body.classList.contains('dark-theme') ? '#ffffff' : '#000000'
                            },
                            margin: { t: 30, r: 30, b: 30, l: 30 }
                        };

                        Plotly.newPlot('content-type-chart', [contentTypeTrace], contentTypeLayout);
                    }
                }
            })
            .catch(error => console.error('Ошибка при обновлении аналитики:', error));
    }
    </script> 